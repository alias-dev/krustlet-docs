<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.81.0" />

<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">



<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Running Krustlet on MicroK8s | Krustlet</title><meta property="og:title" content="Running Krustlet on MicroK8s" />
<meta property="og:description" content="These are steps for running Krustlet node(s) and MicroK8s on the same machine.
Prerequisites You will require a running MicroK8s cluster for this guide. The steps below assume you will run MicroK8s and the Krustlet, on a single machine. kubectl is required but is installed with MicroK8s as microk8s.kubectl. The following instructions use microk8s.kubectl for simplicity. You may use a standlone kubectl if you prefer.
In order for the bootstrap authentication token to work, your kube-apiserver needs to have the --enable-bootstrap-token-auth feature flag enabled." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://docs.krustlet.dev/howto/krustlet-on-microk8s/" /><meta property="article:section" content="howto" />

<meta property="og:site_name" content="Krustlet" />

<meta itemprop="name" content="Running Krustlet on MicroK8s">
<meta itemprop="description" content="These are steps for running Krustlet node(s) and MicroK8s on the same machine.
Prerequisites You will require a running MicroK8s cluster for this guide. The steps below assume you will run MicroK8s and the Krustlet, on a single machine. kubectl is required but is installed with MicroK8s as microk8s.kubectl. The following instructions use microk8s.kubectl for simplicity. You may use a standlone kubectl if you prefer.
In order for the bootstrap authentication token to work, your kube-apiserver needs to have the --enable-bootstrap-token-auth feature flag enabled.">

<meta itemprop="wordCount" content="584">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Running Krustlet on MicroK8s"/>
<meta name="twitter:description" content="These are steps for running Krustlet node(s) and MicroK8s on the same machine.
Prerequisites You will require a running MicroK8s cluster for this guide. The steps below assume you will run MicroK8s and the Krustlet, on a single machine. kubectl is required but is installed with MicroK8s as microk8s.kubectl. The following instructions use microk8s.kubectl for simplicity. You may use a standlone kubectl if you prefer.
In order for the bootstrap authentication token to work, your kube-apiserver needs to have the --enable-bootstrap-token-auth feature flag enabled."/>











<link rel="stylesheet" href="/css/style.2b86b6bda5c37fc229d39310629953b762fc7fdaab9a50a78ece383ebeb01174.css" integrity="sha256-K4a2vaXDf8Ip05MQYplTt2L8f9qrmlCnjs44Pr6wEXQ=">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>



<link rel="stylesheet" href="/css/prism.css" />



  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		
		<span class="text-uppercase font-weight-bold">Krustlet</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://krustlet.dev" target="_blank" ><span>Home</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://docs.krustlet.dev" target="_blank" ><span>Docs</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://github.com/deislabs/krustlet/" target="_blank" ><span>Github</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://kubernetes.slack.com/messages/krustlet" target="_blank" ><span>Slack</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://twitter.com/krustlet" target="_blank" ><span>Twitter</span></a>
			</li>
			
			
			<li class="nav-item dropdown d-none d-lg-block">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Releases 
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="https://docs.krustlet.dev">v0.7.0</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
	
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            




<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <form class="td-sidebar__search d-flex align-items-center">
    


<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.4f9dcfcc0b6a6b7c294ff236e81460faf06aecfdb7559c70065ea62dd9118a92b855401ddaec2a3629084b0bb938f406e5ce410958fc0726354bea99353e56f0.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>


    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  
  <nav class="collapse td-sidebar-nav" id="td-section-nav">
    
    






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/howto/" class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">How-To Guides</a>
  </li>
  <ul>
    <li class="collapse show" id="howto">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtobootstrapping" href="/howto/bootstrapping/">Bootstrapping Krustlet</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokubernetes-on-do" href="/howto/kubernetes-on-do/">Managed Kubernetes on DigitalOcean</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtocsi" href="/howto/csi/">Registering a CSI Driver</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-eks" href="/howto/krustlet-on-eks/">Running Krustlet on Amazon Elastic Kubernetes Service (EKS)</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-azure" href="/howto/krustlet-on-azure/">Running Krustlet on Azure</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-gke" href="/howto/krustlet-on-gke/">Running Krustlet on Google Kubernetes Engine (GKE)</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-kind" href="/howto/krustlet-on-kind/">Running Krustlet on Kubernetes in Docker (KinD)</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-with-inlets" href="/howto/krustlet-with-inlets/">Running Krustlet on Kubernetes with inlets</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-do" href="/howto/krustlet-on-do/">Running Krustlet on Managed Kubernetes on DigitalOcean</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page  active" id="m-howtokrustlet-on-microk8s" href="/howto/krustlet-on-microk8s/">Running Krustlet on MicroK8s</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-minikube" href="/howto/krustlet-on-minikube/">Running Krustlet on Minikube</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-wsl2" href="/howto/krustlet-on-wsl2/">Running Krustlet on WSL2 with Docker Desktop</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokubernetes-on-gke" href="/howto/kubernetes-on-gke/">Running Kubernetes on Google Kubernetes Engine (GKE)</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokubernetes-on-kind" href="/howto/kubernetes-on-kind/">Running Kubernetes on Kubernetes in Docker (KinD)</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokubernetes-on-minikube" href="/howto/kubernetes-on-minikube/">Running Kubernetes on Minikube</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtowasm" href="/howto/wasm/">Running Web Assembly (WASM) workloads in Kubernetes</a>
      
      
    </li>
  </ul>
</ul>

  </nav>
</div>




          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            











<nav id="TableOfContents">
  <ul>
    <li><a href="#prerequisites">Prerequisites</a></li>
    <li><a href="#step-1-get-a-bootstrap-config">Step 1: Get a bootstrap config</a></li>
    <li><a href="#step-2-install-and-configure-krustlet">Step 2: Install and configure Krustlet</a>
      <ul>
        <li><a href="#step-2a-approving-the-serving-csr">Step 2a: Approving the serving CSR</a></li>
      </ul>
    </li>
    <li><a href="#step-3-test-that-things-work">Step 3: Test that things work</a></li>
  </ul>
</nav>



          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		







<li class="breadcrumb-item" >
	<a href="https://docs.krustlet.dev/howto/">How-To Guides</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="https://docs.krustlet.dev/howto/krustlet-on-microk8s/">Running Krustlet on MicroK8s</a>
</li>

	</ol>
</nav	>

            
<div class="td-content">
	<p>These are steps for running Krustlet node(s) and <a href="https://microk8s.io">MicroK8s</a>
on the same machine.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>You will require a running MicroK8s cluster for this guide. The steps below
assume you will run MicroK8s and the Krustlet, on a single machine. <code>kubectl</code> is
required but is installed with MicroK8s as <code>microk8s.kubectl</code>. The following
instructions use <code>microk8s.kubectl</code> for simplicity. You may use a standlone
<code>kubectl</code> if you prefer.</p>
<p>In order for the bootstrap authentication token to work, your kube-apiserver
needs to have the <code>--enable-bootstrap-token-auth</code> feature flag enabled. See
<a href="https://kubernetes.io/docs/reference/access-authn-authz/bootstrap-tokens/">bootstrap-tokens</a>
for more information.</p>
<p>To verify you have the bootstrap authentication feature enabled, check the
process args:</p>
<pre><code class="language-console" data-lang="console">$ ps -ef | grep kube-apiserver | grep &quot;enable-bootstrap-token-auth&quot;
</code></pre><p>If it doesn&rsquo;t show up and you installed using <code>snap</code>, you can find the startup
args in <code>/var/snap/microk8s/current/args/kube-apiserver</code> and add the flag.</p>
<p>Now you need to <a href="https://microk8s.io/docs/configuring-services">restart</a> the
kube-apiserver with the command:</p>
<pre><code class="language-console" data-lang="console">$ systemctl restart snap.microk8s.daemon-apiserver
</code></pre><h2 id="step-1-get-a-bootstrap-config">Step 1: Get a bootstrap config</h2>
<p>Krustlet requires a bootstrap token and config the first time it runs. Follow
the guide <a href="bootstrapping.md">here</a> to generate a bootstrap config and then
return to this document. This will If you already have a kubeconfig available
that you generated through another process, you can proceed to the next step.
However, the credentials Krustlet uses must be part of the <code>system:nodes</code> group
in order for things to function properly.</p>
<blockquote>
<p><strong>NOTE</strong> You should now have a file <code>bootstrap.conf</code> in <code>${HOME}/.krustlet/config</code></p>
</blockquote>
<h2 id="step-2-install-and-configure-krustlet">Step 2: Install and configure Krustlet</h2>
<p>Install the latest release of Krustlet following <a href="../intro/install.md">the install
guide</a>.</p>
<p>Let&rsquo;s use the built in <code>krustlet-wasi</code> provider</p>
<pre><code class="language-console" data-lang="console">$ ./KUBECONFIG=${PWD}/krustlet-config \
  krustlet-wasi \
  --node-ip=127.0.0.1 \
  --node-name=krustlet \
  --bootstrap-file=${HOME}/.krustlet/config/bootstrap.conf
</code></pre><blockquote>
<p><strong>NOTE</strong>: To avoid the Krustlet using your default Kubernetes credentials (<code>~/.kube/config</code>),
it is a good idea to override the default value here using <code>KUBECONFIG</code>. For bootstrapping,
<code>KUBECONFIG</code> must point to a non-existent file (!). Bootstrapping will write a new
configuration file to this location for you.
<strong>NOTE</strong>: If you receive an error that the CSR already exists, you may safely delete
the existing CSR (<code>kubectl delete csr &lt;hostname&gt;-tls</code>) and try again.</p>
</blockquote>
<h3 id="step-2a-approving-the-serving-csr">Step 2a: Approving the serving CSR</h3>
<p>Once you have started Krustlet, there is one more manual step (though this could
be automated depending on your setup) to perform. The client certs Krustlet
needs are generally approved automatically by the API. However, the serving
certs require manual approval. To do this, you&rsquo;ll need the hostname you
specified for the <code>--hostname</code> flag or the output of <code>hostname</code> if you didn&rsquo;t
specify anything. From another terminal that&rsquo;s configured to access the cluster,
run:</p>
<pre><code class="language-console" data-lang="console">$ microk8s.kubectl certificate approve &lt;hostname&gt;-tls
</code></pre><blockquote>
<p><strong>NOTE</strong>: You will only need to do this approval step the first time Krustlet
starts. It will generate and save all of the needed credentials to your machine</p>
</blockquote>
<h2 id="step-3-test-that-things-work">Step 3: Test that things work</h2>
<p>Now you can see things work! Feel free to give any of the demos a try in another
terminal like so:</p>
<pre><code class="language-console" data-lang="console">$ microk8s.kubectl apply --filename=https://raw.githubusercontent.com/deislabs/krustlet/master/demos/wasi/hello-world-rust/k8s.yaml
$ microk8s.kubectl logs pod/hello-world-wasi-rust
hello from stdout!
hello from stderr!
POD_NAME=hello-world-wasi-rust
FOO=bar
CONFIG_MAP_VAL=cool stuff
Args are: []

Bacon ipsum dolor amet chuck turducken porchetta, tri-tip spare ribs t-bone ham hock. Meatloaf
pork belly leberkas, ham beef pig corned beef boudin ground round meatball alcatra jerky.
Pancetta brisket pastrami, flank pork chop ball tip short loin burgdoggen. Tri-tip kevin
shoulder cow andouille. Prosciutto chislic cupim, short ribs venison jerky beef ribs ham hock
short loin fatback. Bresaola meatloaf capicola pancetta, prosciutto chicken landjaeger andouille
swine kielbasa drumstick cupim tenderloin chuck shank. Flank jowl leberkas turducken ham tongue
beef ribs shankle meatloaf drumstick pork t-bone frankfurter tri-tip.
</code></pre>
	
		<style>
  .feedback--answer {
    display: inline-block;
  }
  .feedback--answer-no {
    margin-left: 1em;
  }
  .feedback--response {
    display: none;
    margin-top: 1em;
  }
  .feedback--response__visible {
    display: block;
  }
</style>
<h2 class="feedback--title">Feedback</h2>
<p class="feedback--question">Was this page helpful?</p>
<button class="feedback--answer feedback--answer-yes">Yes</button>
<button class="feedback--answer feedback--answer-no">No</button>
<p class="feedback--response feedback--response-yes">
  Glad to hear it! Please <a href="https://github.com/openservicemesh/osm/issues/new">tell us how we can improve</a>.
</p>
<p class="feedback--response feedback--response-no">
  Sorry to hear that. Please <a href="https://github.com/openservicemesh/osm/issues/new">tell us how we can improve</a>.
</p>
<script>
  const yesButton = document.querySelector('.feedback--answer-yes');
  const noButton = document.querySelector('.feedback--answer-no');
  const yesResponse = document.querySelector('.feedback--response-yes');
  const noResponse = document.querySelector('.feedback--response-no');
  const disableButtons = () => {
    yesButton.disabled = true;
    noButton.disabled = true;
  };
  const sendFeedback = (value) => {
    if (typeof ga !== 'function') return;
    const args = {
      command: 'send',
      hitType: 'event',
      category: 'Helpful',
      action: 'click',
      label: window.location.pathname,
      value: value
    };
    ga(args.command, args.hitType, args.category, args.action, args.label, args.value);
  };
  yesButton.addEventListener('click', () => {
    yesResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(1);
  });
  noButton.addEventListener('click', () => {
    noResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(0);
  });
</script>

		<br />
	
	
</div>


          </main>
        </div>
      </div>
      

<footer class="py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-6 text-xs-center order-sm-2">
        <p class="footer-cncf">Krustlet</p>
      </div>
      <div class="col-6 col-sm-6 text-right text-xs-center order-sm-3">
        <ul class="inline list-inline text-right">
          
          
          <li class="nav-item list-inline-item mr-4 mb-2 mb-lg-0">
            
            
            
            
            <a class="nav-link" href="https://krustlet.dev" target="_blank" ><span>Home</span></a>
          </li>
          
          <li class="nav-item list-inline-item mr-4 mb-2 mb-lg-0">
            
            
            
            
            <a class="nav-link" href="https://docs.krustlet.dev" target="_blank" ><span>Docs</span></a>
          </li>
          
          <li class="nav-item list-inline-item mr-4 mb-2 mb-lg-0">
            
            
            
            
            <a class="nav-link" href="https://github.com/deislabs/krustlet/" target="_blank" ><span>Github</span></a>
          </li>
          
          <li class="nav-item list-inline-item mr-4 mb-2 mb-lg-0">
            
            
            
            
            <a class="nav-link" href="https://kubernetes.slack.com/messages/krustlet" target="_blank" ><span>Slack</span></a>
          </li>
          
          <li class="nav-item list-inline-item mr-4 mb-2 mb-lg-0">
            
            
            
            
            <a class="nav-link" href="https://twitter.com/krustlet" target="_blank" ><span>Twitter</span></a>
          </li>
          
        </ul>
      </div>
    </div>
  </div>
</footer>



    </div>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>










<script src="/js/main.min.63db3e552bd0543be17ce4a79a18b744e9cb72256bec42b540e3ab0cd43722d0.js" integrity="sha256-Y9s&#43;VSvQVDvhfOSnmhi3ROnLciVr7EK1QOOrDNQ3ItA=" crossorigin="anonymous"></script>



<script src='/js/prism.js'></script>



  </body>
</html>
