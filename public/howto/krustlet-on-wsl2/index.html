<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.81.0" />

<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">



<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Running Krustlet on WSL2 with Docker Desktop | Krustlet</title><meta property="og:title" content="Running Krustlet on WSL2 with Docker Desktop" />
<meta property="og:description" content="This how-to guide demonstrates how to boot a Krustlet node in Docker Desktop for Windows with WSL2 backend.
Information This tutorial will work on current Windows 10 Insider Slow ring and Docker Desktop for Windows stable release.
This tutorial will work on current Windows 10 Insider Slow ring and Docker Desktop for Windows stable release.
Concerning Windows, this tutorial should work on the Production ring once it will be available." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://docs.krustlet.dev/howto/krustlet-on-wsl2/" /><meta property="article:section" content="howto" />

<meta property="og:site_name" content="Krustlet" />

<meta itemprop="name" content="Running Krustlet on WSL2 with Docker Desktop">
<meta itemprop="description" content="This how-to guide demonstrates how to boot a Krustlet node in Docker Desktop for Windows with WSL2 backend.
Information This tutorial will work on current Windows 10 Insider Slow ring and Docker Desktop for Windows stable release.
This tutorial will work on current Windows 10 Insider Slow ring and Docker Desktop for Windows stable release.
Concerning Windows, this tutorial should work on the Production ring once it will be available.">

<meta itemprop="wordCount" content="802">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Running Krustlet on WSL2 with Docker Desktop"/>
<meta name="twitter:description" content="This how-to guide demonstrates how to boot a Krustlet node in Docker Desktop for Windows with WSL2 backend.
Information This tutorial will work on current Windows 10 Insider Slow ring and Docker Desktop for Windows stable release.
This tutorial will work on current Windows 10 Insider Slow ring and Docker Desktop for Windows stable release.
Concerning Windows, this tutorial should work on the Production ring once it will be available."/>









<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="//fonts.googleapis.com/css2?family=Poppins:wght@700&family=Work+Sans&display=swap" rel="stylesheet">


<link rel="stylesheet" href="/css/style.984d0cac551d1e618acdbae32aed044ef29a6f388b1a5c5e1193689b6445c90d.css" integrity="sha256-mE0MrFUdHmGKzbrjKu0ETvKabziLGlxeEZNom2RFyQ0=">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>



<link rel="stylesheet" href="/css/prism.css" />



  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand flex-column flex-md-row td-navbar">
	
	<div class="deislabs">
		<a href="https://deislabs.io/" title="Deis Labs">
			<span>Deis Labs</span>
			<div class="shapes top"><em class="dl-tr"></em><em class="dl-sq"></em><em class="dl-ci"></em></div>
		</a>
	</div>
	<a class="navbar-brand" href="/">
		<span class="text-uppercase font-weight-bold">Krustlet</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://krustlet.dev" target="_blank" ><span>Home</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://docs.krustlet.dev" target="_blank" ><span>Docs</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://github.com/deislabs/krustlet/" target="_blank" ><span>Github</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://kubernetes.slack.com/messages/krustlet" target="_blank" ><span>Slack</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://twitter.com/krustlet" target="_blank" ><span>Twitter</span></a>
			</li>
			
			
			<li class="nav-item dropdown d-none d-lg-block">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Releases 
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="https://docs.krustlet.dev">v0.7.0</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
	
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-3 td-sidebar d-print-none">
            




<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <form class="td-sidebar__search d-flex align-items-center">
    


<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.59616654c3bfdc16be8f9dd0f8c7d4098b085d188474d154dbd361cbacd53f5dc104423f9001c90cc16edf2835d27dfb8f6ac36acfe812cbaee597f651510a1b.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>


    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  
  <nav class="collapse td-sidebar-nav" id="td-section-nav">
    
    






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/howto/" class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">How-To Guides</a>
  </li>
  <ul>
    <li class="collapse show" id="howto">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtobootstrapping" href="/howto/bootstrapping/">Bootstrapping Krustlet</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokubernetes-on-do" href="/howto/kubernetes-on-do/">Managed Kubernetes on DigitalOcean</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtocsi" href="/howto/csi/">Registering a CSI Driver</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-eks" href="/howto/krustlet-on-eks/">Running Krustlet on Amazon Elastic Kubernetes Service (EKS)</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-azure" href="/howto/krustlet-on-azure/">Running Krustlet on Azure</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-gke" href="/howto/krustlet-on-gke/">Running Krustlet on Google Kubernetes Engine (GKE)</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-kind" href="/howto/krustlet-on-kind/">Running Krustlet on Kubernetes in Docker (KinD)</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-with-inlets" href="/howto/krustlet-with-inlets/">Running Krustlet on Kubernetes with inlets</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-do" href="/howto/krustlet-on-do/">Running Krustlet on Managed Kubernetes on DigitalOcean</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-microk8s" href="/howto/krustlet-on-microk8s/">Running Krustlet on MicroK8s</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-minikube" href="/howto/krustlet-on-minikube/">Running Krustlet on Minikube</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page  active" id="m-howtokrustlet-on-wsl2" href="/howto/krustlet-on-wsl2/">Running Krustlet on WSL2 with Docker Desktop</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokubernetes-on-gke" href="/howto/kubernetes-on-gke/">Running Kubernetes on Google Kubernetes Engine (GKE)</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokubernetes-on-kind" href="/howto/kubernetes-on-kind/">Running Kubernetes on Kubernetes in Docker (KinD)</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokubernetes-on-minikube" href="/howto/kubernetes-on-minikube/">Running Kubernetes on Minikube</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtowasm" href="/howto/wasm/">Running Web Assembly (WASM) workloads in Kubernetes</a>
      
      
    </li>
  </ul>
</ul>

  </nav>
</div>




          </div>
          
          <main class="col-12 col-md-9 col-xl-9 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none breadcrumb-wrapper">
	<ol class="breadcrumb spb-1">
		







<li class="breadcrumb-item" >
	<a href="https://docs.krustlet.dev/howto/">How-To Guides</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="https://docs.krustlet.dev/howto/krustlet-on-wsl2/">Running Krustlet on WSL2 with Docker Desktop</a>
</li>

	</ol>
</nav	>


            
<div class="td-content">
	<h1>Running Krustlet on WSL2 with Docker Desktop</h1>
	<p>This how-to guide demonstrates how to boot a Krustlet node in Docker Desktop for
Windows with WSL2 backend.</p>
<h2 id="information">Information</h2>
<p>This tutorial will work on current Windows 10 Insider Slow ring and Docker
Desktop for Windows stable release.</p>
<p>This tutorial will work on current Windows 10 Insider Slow ring and Docker
Desktop for Windows stable release.</p>
<p>Concerning Windows, this tutorial should work on the Production ring once it
will be available.</p>
<p>Last but not least, this will work on Windows 10 Home edition.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>You will require a WSL2 distro and Docker Desktop for Windows for this how-to.
The WSL2 backend and Kubernetes features will need to be also enabled. See the
<a href="https://docs.docker.com/docker-for-windows/#kubernetes">Docker Desktop for Windows &gt; Getting started &gt;
Kubernetes</a> howto for
more information.</p>
<p>This specific tutorial will be running Krustlet on your WSL2 distro and will
explain how to access it from Windows.</p>
<h2 id="step-1-determine-the-default-gateway">Step 1: Determine the default gateway</h2>
<p>The default gateway for most Docker containers is generally <code>172.17.0.1</code>. This
IP is only reachable, by default, from the WSL2 distro. However, the <code>eth0</code> host
network is accessible from Windows, so we can use this IP address to connect to
the WSL2 distro (where Krustlet is running).</p>
<p>If this was changed, check <code>ifconfig eth0</code> from the host OS to determine the
default gateway:</p>
<pre><code class="language-console" data-lang="console">$ ifconfig eth0
eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 172.26.47.208  netmask 255.255.240.0  broadcast 172.26.47.255
        inet6 fe80::215:5dff:fe98:ce48  prefixlen 64  scopeid 0x20&lt;link&gt;
        ether 00:15:5d:98:ce:48  txqueuelen 1000  (Ethernet)
        RX packets 16818  bytes 11576089 (11.0 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 1093  bytes 115724 (113.0 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</code></pre><p>In this example, I should use <code>172.26.47.208</code>.</p>
<blockquote>
<p>TIP: get the IP from <code>eth0</code></p>
</blockquote>
<pre><code class="language-console" data-lang="console">$ export mainIP=$(ifconfig eth0 | grep &quot;inet &quot; | awk '{ print $2 }')
</code></pre><p>The hostname being &ldquo;applied&rdquo; from Windows, the default hostname will not resolve
to this address, therefore you need to pass the <code>--node-ip</code> and <code>--node-name</code>
flag to Krustlet.</p>
<h2 id="step-2-get-a-bootstrap-config">Step 2: Get a bootstrap config</h2>
<p>Krustlet requires a bootstrap token and config the first time it runs. Follow
the guide <a href="bootstrapping.md">here</a> to generate a bootstrap config and then
return to this document. This will If you already have a kubeconfig available
that you generated through another process, you can proceed to the next step.
However, the credentials Krustlet uses must be part of the <code>system:nodes</code> group
in order for things to function properly.</p>
<h2 id="step-3-install-and-run-krustlet">Step 3: Install and run Krustlet</h2>
<p>First, install the latest release of Krustlet following <a href="../intro/install.md">the install
guide</a>.</p>
<p>Second, ensure the Kubernetes context is correctly set to <code>docker-desktop</code>:</p>
<pre><code class="language-console" data-lang="console">$ kubectl config get-contexts
CURRENT   NAME                 CLUSTER          AUTHINFO         NAMESPACE
*         docker-desktop       docker-desktop   docker-desktop

# Optional if the context is not set correctly
$ kubectl config set-context docker-desktop
Context &quot;docker-desktop&quot; modified.
</code></pre><p>Once you have done that, run the following commands to run Krustlet&rsquo;s WASI
provider:</p>
<pre><code class="language-console" data-lang="console"># Since you are running locally, this step is important. Otherwise krustlet will pick up on your
# local config and not be able to update the node status properly
$ export KUBECONFIG=~/.krustlet/config/kubeconfig
$ krustlet-wasi --node-ip $mainIP --node-name krustlet --bootstrap-file=~/.krustlet/config/bootstrap.conf
</code></pre><h3 id="step-3a-approving-the-serving-csr">Step 3a: Approving the serving CSR</h3>
<p>Once you have started Krustlet, there is one more manual step (though this could
be automated depending on your setup) to perform. The client certs Krustlet
needs are generally approved automatically by the API. However, the serving
certs require manual approval. To do this, you&rsquo;ll need the hostname you
specified for the <code>--hostname</code> flag or the output of <code>hostname</code> if you didn&rsquo;t
specify anything. From another terminal that&rsquo;s configured to access the cluster,
run:</p>
<pre><code class="language-console" data-lang="console">$ kubectl certificate approve &lt;hostname&gt;-tls
</code></pre><p>NOTE: You will only need to do this approval step the first time Krustlet
starts. It will generate and save all of the needed credentials to your machine</p>
<p>In another terminal, run <code>kubectl get nodes -o wide</code> and you should see output
that looks similar to below:</p>
<pre><code class="language-console" data-lang="console">$ kubectl get nodes -o wide
NAME             STATUS   ROLES    AGE     VERSION   INTERNAL-IP     EXTERNAL-IP   OS-IMAGE         KERNEL-VERSION                CONTAINER-RUNTIME
docker-desktop   Ready    master   3d23h   v1.15.5   192.168.65.3    &lt;none&gt;        Docker Desktop   4.19.104-microsoft-standard   docker://19.3.8
krustlet      Ready    agent    34s     v1.17.0   172.26.47.208   &lt;none&gt;        &lt;unknown&gt;        &lt;unknown&gt;                     mvp
</code></pre><h2 id="optional-delete-the-krustlet-node">Optional: Delete the Krustlet node</h2>
<p>Once you will no more need the Krustlet node, you can remove it from your
cluster with the following <code>kubectl delete node</code> command:</p>
<pre><code class="language-console" data-lang="console">$ kubectl delete node krustlet
node &quot;krustlet&quot; deleted

$ kubectl get nodes -o wide
NAME             STATUS   ROLES    AGE   VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE         KERNEL-VERSION                CONTAINER-RUNTIME
docker-desktop   Ready    master   4d    v1.15.5   192.168.65.3   &lt;none&gt;        Docker Desktop   4.19.104-microsoft-standard   docker://19.3.8
</code></pre><h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="wasm-workloads-on-docker-desktop">WASM workloads on Docker Desktop</h3>
<p>Docker Desktop&rsquo;s Kubernetes always provides a schedulable node called
<code>docker-desktop</code>. This node uses Docker to run containers. If you want to run
WASM workloads on Krustlet, you must prevent these pods from being scheduled to
the <code>docker-desktop</code> node. You can do this using a nodeSelector in pod specs.
See <a href="../howto/wasm.md">Running WASM workloads</a> for details.</p>

	
	
</div>


          </main>
        </div>
      </div>
      

<footer class="py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-6 text-xs-center order-sm-2">
        <p class="footer-cncf">Krustlet</p>
      </div>
      <div class="col-6 col-sm-6 text-right text-xs-center order-sm-3">
        <ul class="inline list-inline text-right">
          
          
          <li class="nav-item list-inline-item mr-4 mb-2 mb-lg-0">
            
            
            
            
            <a class="nav-link" href="https://krustlet.dev" target="_blank" ><span>Home</span></a>
          </li>
          
          <li class="nav-item list-inline-item mr-4 mb-2 mb-lg-0">
            
            
            
            
            <a class="nav-link" href="https://docs.krustlet.dev" target="_blank" ><span>Docs</span></a>
          </li>
          
          <li class="nav-item list-inline-item mr-4 mb-2 mb-lg-0">
            
            
            
            
            <a class="nav-link" href="https://github.com/deislabs/krustlet/" target="_blank" ><span>Github</span></a>
          </li>
          
          <li class="nav-item list-inline-item mr-4 mb-2 mb-lg-0">
            
            
            
            
            <a class="nav-link" href="https://kubernetes.slack.com/messages/krustlet" target="_blank" ><span>Slack</span></a>
          </li>
          
          <li class="nav-item list-inline-item mr-4 mb-2 mb-lg-0">
            
            
            
            
            <a class="nav-link" href="https://twitter.com/krustlet" target="_blank" ><span>Twitter</span></a>
          </li>
          
        </ul>
      </div>
    </div>
  </div>
</footer>



    </div>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>










<script src="/js/main.min.63db3e552bd0543be17ce4a79a18b744e9cb72256bec42b540e3ab0cd43722d0.js" integrity="sha256-Y9s&#43;VSvQVDvhfOSnmhi3ROnLciVr7EK1QOOrDNQ3ItA=" crossorigin="anonymous"></script>



<script src='/js/prism.js'></script>



  </body>
</html>
