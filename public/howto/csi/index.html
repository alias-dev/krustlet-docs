<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.81.0" />

<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">



<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Registering a CSI Driver | Krustlet</title><meta property="og:title" content="Registering a CSI Driver" />
<meta property="og:description" content="For more information on what is the Container Storage Interface and how it relates to a CSI driver, see the topic guide for more information.
A Krustlet Provider with CSI support will check for new drivers registered to the plugins/ directory (by default, this is $HOME/.krustlet/plugins). You will need to inform your CSI driver to bind its socket at that location in order for a Provider to recognize and register the driver." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://docs.krustlet.dev/howto/csi/" /><meta property="article:section" content="howto" />

<meta property="og:site_name" content="Krustlet" />

<meta itemprop="name" content="Registering a CSI Driver">
<meta itemprop="description" content="For more information on what is the Container Storage Interface and how it relates to a CSI driver, see the topic guide for more information.
A Krustlet Provider with CSI support will check for new drivers registered to the plugins/ directory (by default, this is $HOME/.krustlet/plugins). You will need to inform your CSI driver to bind its socket at that location in order for a Provider to recognize and register the driver.">

<meta itemprop="wordCount" content="517">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Registering a CSI Driver"/>
<meta name="twitter:description" content="For more information on what is the Container Storage Interface and how it relates to a CSI driver, see the topic guide for more information.
A Krustlet Provider with CSI support will check for new drivers registered to the plugins/ directory (by default, this is $HOME/.krustlet/plugins). You will need to inform your CSI driver to bind its socket at that location in order for a Provider to recognize and register the driver."/>









<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="//fonts.googleapis.com/css2?family=Poppins:wght@700&family=Work+Sans&display=swap" rel="stylesheet">


<link rel="stylesheet" href="/css/style.984d0cac551d1e618acdbae32aed044ef29a6f388b1a5c5e1193689b6445c90d.css" integrity="sha256-mE0MrFUdHmGKzbrjKu0ETvKabziLGlxeEZNom2RFyQ0=">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>



<link rel="stylesheet" href="/css/prism.css" />



  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand flex-column flex-md-row td-navbar">
	
	<div class="deislabs">
		<a href="https://deislabs.io/" title="Deis Labs">
			<span>Deis Labs</span>
			<div class="shapes top"><em class="dl-tr"></em><em class="dl-sq"></em><em class="dl-ci"></em></div>
		</a>
	</div>
	<a class="navbar-brand" href="/">
		<span class="text-uppercase font-weight-bold">Krustlet</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://krustlet.dev" target="_blank" ><span>Home</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://docs.krustlet.dev" target="_blank" ><span>Docs</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://github.com/deislabs/krustlet/" target="_blank" ><span>Github</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://kubernetes.slack.com/messages/krustlet" target="_blank" ><span>Slack</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://twitter.com/krustlet" target="_blank" ><span>Twitter</span></a>
			</li>
			
			
			<li class="nav-item dropdown d-none d-lg-block">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Releases 
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="https://docs.krustlet.dev">v0.7.0</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
	
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-3 td-sidebar d-print-none">
            




<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <form class="td-sidebar__search d-flex align-items-center">
    


<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.59616654c3bfdc16be8f9dd0f8c7d4098b085d188474d154dbd361cbacd53f5dc104423f9001c90cc16edf2835d27dfb8f6ac36acfe812cbaee597f651510a1b.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>


    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  
  <nav class="collapse td-sidebar-nav" id="td-section-nav">
    
    






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/howto/" class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">How-To Guides</a>
  </li>
  <ul>
    <li class="collapse show" id="howto">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtobootstrapping" href="/howto/bootstrapping/">Bootstrapping Krustlet</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokubernetes-on-do" href="/howto/kubernetes-on-do/">Managed Kubernetes on DigitalOcean</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page  active" id="m-howtocsi" href="/howto/csi/">Registering a CSI Driver</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-eks" href="/howto/krustlet-on-eks/">Running Krustlet on Amazon Elastic Kubernetes Service (EKS)</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-azure" href="/howto/krustlet-on-azure/">Running Krustlet on Azure</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-gke" href="/howto/krustlet-on-gke/">Running Krustlet on Google Kubernetes Engine (GKE)</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-kind" href="/howto/krustlet-on-kind/">Running Krustlet on Kubernetes in Docker (KinD)</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-with-inlets" href="/howto/krustlet-with-inlets/">Running Krustlet on Kubernetes with inlets</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-do" href="/howto/krustlet-on-do/">Running Krustlet on Managed Kubernetes on DigitalOcean</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-microk8s" href="/howto/krustlet-on-microk8s/">Running Krustlet on MicroK8s</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-minikube" href="/howto/krustlet-on-minikube/">Running Krustlet on Minikube</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-wsl2" href="/howto/krustlet-on-wsl2/">Running Krustlet on WSL2 with Docker Desktop</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokubernetes-on-gke" href="/howto/kubernetes-on-gke/">Running Kubernetes on Google Kubernetes Engine (GKE)</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokubernetes-on-kind" href="/howto/kubernetes-on-kind/">Running Kubernetes on Kubernetes in Docker (KinD)</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokubernetes-on-minikube" href="/howto/kubernetes-on-minikube/">Running Kubernetes on Minikube</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtowasm" href="/howto/wasm/">Running Web Assembly (WASM) workloads in Kubernetes</a>
      
      
    </li>
  </ul>
</ul>

  </nav>
</div>




          </div>
          
          <main class="col-12 col-md-9 col-xl-9 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none breadcrumb-wrapper">
	<ol class="breadcrumb spb-1">
		







<li class="breadcrumb-item" >
	<a href="https://docs.krustlet.dev/howto/">How-To Guides</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="https://docs.krustlet.dev/howto/csi/">Registering a CSI Driver</a>
</li>

	</ol>
</nav	>


            
<div class="td-content">
	<h1>Registering a CSI Driver</h1>
	<p>For more information on what is the Container Storage Interface and how it
relates to a CSI driver, see the <a href="../topics/csi.md">topic guide</a> for more
information.</p>
<p>A Krustlet Provider with CSI support will check for new drivers registered to
the <code>plugins/</code> directory (by default, this is <code>$HOME/.krustlet/plugins</code>). You
will need to inform your CSI driver to bind its socket at that location in order
for a Provider to recognize and register the driver.</p>
<p>You will also need to install and run the following projects so that the
PersistentVolumeClaim&rsquo;s volume will be provisioned and readily available for
use:</p>
<ul>
<li><a href="https://github.com/kubernetes-csi/node-driver-registrar">node-driver-registrar</a></li>
<li><a href="https://github.com/kubernetes-csi/external-provisioner">external-provisioner</a></li>
</ul>
<p>Do keep in mind that some CSI drivers rely on linux-specific command line
tooling like <code>mount</code>, so these tools may only work on Linux. Cross-platform
support is not guaranteed. Refer to the driver&rsquo;s documentation for more
information.</p>
<h2 id="how-do-i-use-a-csi-volume">How do I use a CSI Volume?</h2>
<p>Assuming a CSI storage plugin is already deployed on your cluster, you can use
it through familiar Kubernetes storage primitives: PersistentVolumeClaims,
PersistentVolumes, and StorageClasses.</p>
<p>A basic example to start with would be the <a href="https://github.com/kubernetes-csi/csi-driver-host-path">host-path CSI
driver</a>. This project is
not recommended for use in production, but will work as an example.</p>
<p>To start, we&rsquo;ll need to create a StorageClass. A StorageClass provides a way for
administrators to describe the &ldquo;classes&rdquo; of storage they offer. Different
classes might map to quality-of-service levels, or to backup policies, or to
arbitrary policies determined by the cluster administrators. Kubernetes itself
is unopinionated about what classes represent. This concept is sometimes called
&ldquo;profiles&rdquo; in other storage systems.</p>
<p>The following StorageClass enables dynamic creation of &ldquo;csi-hostpath-sc&rdquo; volumes
by a CSI volume plugin called &ldquo;hostpath.csi.k8s.io&rdquo;. This storage class will
also allow for <a href="https://github.com/kubernetes-csi/external-resizer">volume
expansion</a>.</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="font-weight:bold">apiVersion</span>: storage.k8s.io/v1
<span style="font-weight:bold">kind</span>: StorageClass
<span style="font-weight:bold">metadata</span>:
  <span style="font-weight:bold">name</span>: csi-hostpath-sc
<span style="font-weight:bold">provisioner</span>: hostpath.csi.k8s.io
<span style="font-weight:bold">reclaimPolicy</span>: Delete
<span style="font-weight:bold">volumeBindingMode</span>: Immediate
<span style="font-weight:bold">allowVolumeExpansion</span>: <span style="color:#fff;font-weight:bold">true</span>
</code></pre></div><p>After installing a StorageClass, we can start creating PersistentVolumeClaims to
provision and prepare volumes. These will be mounted to Kubernetes Pods that
request it as a volume. Note how the PVC requests the same StorageClass we
created earlier.</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="font-weight:bold">apiVersion</span>: v1
<span style="font-weight:bold">kind</span>: PersistentVolumeClaim
<span style="font-weight:bold">metadata</span>:
  <span style="font-weight:bold">name</span>: csi-pvc
<span style="font-weight:bold">spec</span>:
  <span style="font-weight:bold">accessModes</span>:
  - ReadWriteOnce
  <span style="font-weight:bold">resources</span>:
    <span style="font-weight:bold">requests</span>:
      <span style="font-weight:bold">storage</span>: 1Gi
  <span style="font-weight:bold">storageClassName</span>: csi-hostpath-sc
</code></pre></div><p>A Pod can then request that volume to be mounted by using the <code>volumes</code> API.</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="font-weight:bold">kind</span>: Pod
<span style="font-weight:bold">apiVersion</span>: v1
<span style="font-weight:bold">metadata</span>:
  <span style="font-weight:bold">name</span>: my-frontend
<span style="font-weight:bold">spec</span>:
  <span style="font-weight:bold">containers</span>:
    - <span style="font-weight:bold">name</span>: my-frontend
      <span style="font-weight:bold">image</span>: example.com/my-frontend:v1.0.0
      <span style="font-weight:bold">volumeMounts</span>:
      - <span style="font-weight:bold">mountPath</span>: <span style="color:#0ff;font-weight:bold">&#34;/data&#34;</span>
        <span style="font-weight:bold">name</span>: my-csi-volume
  <span style="font-weight:bold">volumes</span>:
    - <span style="font-weight:bold">name</span>: my-csi-volume
      <span style="font-weight:bold">persistentVolumeClaim</span>:
        <span style="font-weight:bold">claimName</span>: csi-pvc
</code></pre></div><p>When the pod referencing a CSI volume is scheduled, Krustlet will trigger the
appropriate operations against the external CSI plugin (ControllerPublishVolume,
NodePublishVolume, etc.) to ensure the specified volume is attached, mounted,
and ready to use by the containers in the pod.</p>
<h2 id="addendum-role-based-access-control">Addendum: Role-based Access Control</h2>
<p>In the event that the Pod is erroring saying that the kubelet doesn&rsquo;t have the
correct admission controls to access storage classes, you&rsquo;ll have to create the
following cluster role and role binding to allow the <code>system:nodes</code> group to
access them:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="font-weight:bold">apiVersion</span>: rbac.authorization.k8s.io/v1
<span style="font-weight:bold">kind</span>: ClusterRole
<span style="font-weight:bold">metadata</span>:
  <span style="font-weight:bold">name</span>: storageclass-reader
<span style="font-weight:bold">rules</span>:
  - <span style="font-weight:bold">apiGroups</span>: [<span style="color:#0ff;font-weight:bold">&#34;storage.k8s.io&#34;</span>]
    <span style="font-weight:bold">resources</span>: [<span style="color:#0ff;font-weight:bold">&#34;storageclasses&#34;</span>]
    <span style="font-weight:bold">verbs</span>: [<span style="color:#0ff;font-weight:bold">&#34;get&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;watch&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;list&#34;</span>]
---
<span style="font-weight:bold">apiVersion</span>: rbac.authorization.k8s.io/v1
<span style="font-weight:bold">kind</span>: ClusterRoleBinding
<span style="font-weight:bold">metadata</span>:
  <span style="font-weight:bold">name</span>: node-storageclass-reader
<span style="font-weight:bold">subjects</span>:
  - <span style="font-weight:bold">kind</span>: Group
    <span style="font-weight:bold">name</span>: system:nodes
    <span style="font-weight:bold">apiGroup</span>: rbac.authorization.k8s.io
<span style="font-weight:bold">roleRef</span>:
  <span style="font-weight:bold">apiGroup</span>: rbac.authorization.k8s.io
  <span style="font-weight:bold">kind</span>: ClusterRole
  <span style="font-weight:bold">name</span>: storageclass-reader
</code></pre></div>
	
	
</div>


          </main>
        </div>
      </div>
      

<footer class="py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-6 text-xs-center order-sm-2">
        <p class="footer-cncf">Krustlet</p>
      </div>
      <div class="col-6 col-sm-6 text-right text-xs-center order-sm-3">
        <ul class="inline list-inline text-right">
          
          
          <li class="nav-item list-inline-item mr-4 mb-2 mb-lg-0">
            
            
            
            
            <a class="nav-link" href="https://krustlet.dev" target="_blank" ><span>Home</span></a>
          </li>
          
          <li class="nav-item list-inline-item mr-4 mb-2 mb-lg-0">
            
            
            
            
            <a class="nav-link" href="https://docs.krustlet.dev" target="_blank" ><span>Docs</span></a>
          </li>
          
          <li class="nav-item list-inline-item mr-4 mb-2 mb-lg-0">
            
            
            
            
            <a class="nav-link" href="https://github.com/deislabs/krustlet/" target="_blank" ><span>Github</span></a>
          </li>
          
          <li class="nav-item list-inline-item mr-4 mb-2 mb-lg-0">
            
            
            
            
            <a class="nav-link" href="https://kubernetes.slack.com/messages/krustlet" target="_blank" ><span>Slack</span></a>
          </li>
          
          <li class="nav-item list-inline-item mr-4 mb-2 mb-lg-0">
            
            
            
            
            <a class="nav-link" href="https://twitter.com/krustlet" target="_blank" ><span>Twitter</span></a>
          </li>
          
        </ul>
      </div>
    </div>
  </div>
</footer>



    </div>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>










<script src="/js/main.min.63db3e552bd0543be17ce4a79a18b744e9cb72256bec42b540e3ab0cd43722d0.js" integrity="sha256-Y9s&#43;VSvQVDvhfOSnmhi3ROnLciVr7EK1QOOrDNQ3ItA=" crossorigin="anonymous"></script>



<script src='/js/prism.js'></script>



  </body>
</html>
