<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.81.0" />

<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">



<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Bootstrapping Krustlet | Krustlet</title><meta property="og:title" content="Bootstrapping Krustlet" />
<meta property="og:description" content="As of version 0.3.0, Krustlet supports automatic bootstrapping of its authorization and serving certificates. This document describes how the functionality works.
Initialization Krustlet follows the same initialization flow as Kubelet (with the exception of automatic renewal of certs that are close to expiry).
Instructions In order to join a cluster with the proper permissions, Krustlet requires a valid bootstrap config with a valid bootstrap token. This token can be generated with kubeadm or may already exist depending on your provider." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://docs.krustlet.dev/howto/bootstrapping/" /><meta property="article:section" content="howto" />

<meta property="og:site_name" content="Krustlet" />

<meta itemprop="name" content="Bootstrapping Krustlet">
<meta itemprop="description" content="As of version 0.3.0, Krustlet supports automatic bootstrapping of its authorization and serving certificates. This document describes how the functionality works.
Initialization Krustlet follows the same initialization flow as Kubelet (with the exception of automatic renewal of certs that are close to expiry).
Instructions In order to join a cluster with the proper permissions, Krustlet requires a valid bootstrap config with a valid bootstrap token. This token can be generated with kubeadm or may already exist depending on your provider.">

<meta itemprop="wordCount" content="765">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Bootstrapping Krustlet"/>
<meta name="twitter:description" content="As of version 0.3.0, Krustlet supports automatic bootstrapping of its authorization and serving certificates. This document describes how the functionality works.
Initialization Krustlet follows the same initialization flow as Kubelet (with the exception of automatic renewal of certs that are close to expiry).
Instructions In order to join a cluster with the proper permissions, Krustlet requires a valid bootstrap config with a valid bootstrap token. This token can be generated with kubeadm or may already exist depending on your provider."/>











<link rel="stylesheet" href="/css/style.2b86b6bda5c37fc229d39310629953b762fc7fdaab9a50a78ece383ebeb01174.css" integrity="sha256-K4a2vaXDf8Ip05MQYplTt2L8f9qrmlCnjs44Pr6wEXQ=">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>



<link rel="stylesheet" href="/css/prism.css" />



  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		
		<span class="text-uppercase font-weight-bold">Krustlet</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://krustlet.dev" target="_blank" ><span>Home</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://docs.krustlet.dev" target="_blank" ><span>Docs</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://github.com/deislabs/krustlet/" target="_blank" ><span>Github</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://kubernetes.slack.com/messages/krustlet" target="_blank" ><span>Slack</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://twitter.com/krustlet" target="_blank" ><span>Twitter</span></a>
			</li>
			
			
			<li class="nav-item dropdown d-none d-lg-block">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Releases 
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="https://docs.krustlet.dev">v0.7.0</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
	
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            




<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <form class="td-sidebar__search d-flex align-items-center">
    


<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.4f9dcfcc0b6a6b7c294ff236e81460faf06aecfdb7559c70065ea62dd9118a92b855401ddaec2a3629084b0bb938f406e5ce410958fc0726354bea99353e56f0.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>


    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  
  <nav class="collapse td-sidebar-nav" id="td-section-nav">
    
    






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/howto/" class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">How-To Guides</a>
  </li>
  <ul>
    <li class="collapse show" id="howto">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page  active" id="m-howtobootstrapping" href="/howto/bootstrapping/">Bootstrapping Krustlet</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokubernetes-on-do" href="/howto/kubernetes-on-do/">Managed Kubernetes on DigitalOcean</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtocsi" href="/howto/csi/">Registering a CSI Driver</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-eks" href="/howto/krustlet-on-eks/">Running Krustlet on Amazon Elastic Kubernetes Service (EKS)</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-azure" href="/howto/krustlet-on-azure/">Running Krustlet on Azure</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-gke" href="/howto/krustlet-on-gke/">Running Krustlet on Google Kubernetes Engine (GKE)</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-kind" href="/howto/krustlet-on-kind/">Running Krustlet on Kubernetes in Docker (KinD)</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-with-inlets" href="/howto/krustlet-with-inlets/">Running Krustlet on Kubernetes with inlets</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-do" href="/howto/krustlet-on-do/">Running Krustlet on Managed Kubernetes on DigitalOcean</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-microk8s" href="/howto/krustlet-on-microk8s/">Running Krustlet on MicroK8s</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-minikube" href="/howto/krustlet-on-minikube/">Running Krustlet on Minikube</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokrustlet-on-wsl2" href="/howto/krustlet-on-wsl2/">Running Krustlet on WSL2 with Docker Desktop</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokubernetes-on-gke" href="/howto/kubernetes-on-gke/">Running Kubernetes on Google Kubernetes Engine (GKE)</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokubernetes-on-kind" href="/howto/kubernetes-on-kind/">Running Kubernetes on Kubernetes in Docker (KinD)</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtokubernetes-on-minikube" href="/howto/kubernetes-on-minikube/">Running Kubernetes on Minikube</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-howtowasm" href="/howto/wasm/">Running Web Assembly (WASM) workloads in Kubernetes</a>
      
      
    </li>
  </ul>
</ul>

  </nav>
</div>




          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            











<nav id="TableOfContents">
  <ul>
    <li><a href="#initialization">Initialization</a></li>
    <li><a href="#instructions">Instructions</a>
      <ul>
        <li><a href="#prerequisites">Prerequisites</a></li>
        <li><a href="#generating-a-token-and-kubeconfig">Generating a token and kubeconfig</a></li>
        <li><a href="#running-krustlet">Running Krustlet</a></li>
        <li><a href="#approving-the-serving-csr">Approving the serving CSR</a></li>
      </ul>
    </li>
  </ul>
</nav>



          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		







<li class="breadcrumb-item" >
	<a href="https://docs.krustlet.dev/howto/">How-To Guides</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="https://docs.krustlet.dev/howto/bootstrapping/">Bootstrapping Krustlet</a>
</li>

	</ol>
</nav	>

            
<div class="td-content">
	<p>As of version 0.3.0, Krustlet supports automatic bootstrapping of its
authorization and serving certificates. This document describes how the
functionality works.</p>
<h2 id="initialization">Initialization</h2>
<p>Krustlet follows the same <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet-tls-bootstrapping/#initialization-process">initialization
flow</a>
as Kubelet (with the exception of automatic renewal of certs that are close to
expiry).</p>
<h2 id="instructions">Instructions</h2>
<p>In order to join a cluster with the proper permissions, Krustlet requires a
valid bootstrap config with a valid bootstrap token. This token can be generated
with
<a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/"><code>kubeadm</code></a>
or may already exist depending on your provider. However, in this case, we will
be using an easier method for creating a join token. Either way, the examples
here should be useful for figuring out how to do it differently depending on
your setup.</p>
<h3 id="prerequisites">Prerequisites</h3>
<p>You will need <code>kubectl</code>
<a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">installed</a> and a
kubeconfig that has access to create <code>Secrets</code> in the <code>kube-system</code> namespace
and can approve <code>CertificateSigningRequests</code>.</p>
<h3 id="generating-a-token-and-kubeconfig">Generating a token and kubeconfig</h3>
<p>We have a useful bootstrapping <a href="./assets/bootstrap.sh">bash script</a> or
<a href="./assets/bootstrap.sh">Powershell script</a> that can be used for generating a
token and creating a bootstrap kubeconfig file. If you have cloned the repo, you
can run:</p>
<pre><code class="language-console" data-lang="console">$ ./docs/howto/assets/bootstrap.sh
</code></pre><p>OR</p>
<pre><code class="language-console" data-lang="console">$ .\docs\howto\assets\bootstrap.ps1
</code></pre><p>If you are the trusting sort, you can pipe it in from the internet:</p>
<pre><code class="language-console" data-lang="console">$ bash &lt;(curl https://raw.githubusercontent.com/deislabs/krustlet/master/docs/howto/assets/bootstrap.sh)
</code></pre><p>OR</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">Invoke-WebRequest</span> <span style="color:#000">-UseBasicParsing</span> <span style="color:#000">https</span><span style="color:#a40000">:</span><span style="color:#000;font-weight:bold">//</span><span style="color:#000">raw</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">githubusercontent</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">com</span><span style="color:#000;font-weight:bold">/</span><span style="color:#000">deislabs</span><span style="color:#000;font-weight:bold">/</span><span style="color:#000">krustlet</span><span style="color:#000;font-weight:bold">/</span><span style="color:#000">master</span><span style="color:#000;font-weight:bold">/</span><span style="color:#000">docs</span><span style="color:#000;font-weight:bold">/</span><span style="color:#000">howto</span><span style="color:#000;font-weight:bold">/</span><span style="color:#000">assets</span><span style="color:#000;font-weight:bold">/</span><span style="color:#000">bootstrap</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ps1</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Content</span> <span style="color:#000;font-weight:bold">|</span> <span style="color:#204a87">Invoke-Expression</span>
</code></pre></div><p>This will output a ready-to-use bootstrap config to
<code>$HOME/.krustlet/config/bootstrap.conf</code></p>
<h4 id="script-configuration">Script configuration</h4>
<p>The script also exposes a few configuration options by means of environment
variables. These are detailed in the table below:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CONFIG_DIR</code></td>
<td>The location of your configuration directory for Krustlet. Should be the same as <code>$KRUSTLET_DATA_DIR/config</code> where the <code>KRUSTLET_DATA_DIR</code> setting is the same one you use for configuring Krustlet</td>
<td><code>$HOME/.krustlet/config</code></td>
</tr>
<tr>
<td><code>FILE_NAME</code></td>
<td>The name of the file the bootstrap config should be saved to</td>
<td><code>bootstrap.conf</code></td>
</tr>
</tbody>
</table>
<h4 id="nitty-gritty-details">Nitty-gritty details</h4>
<p>This section contains an overview of the nitty-gritty details for those who may
be constructing their own bootstrapping setup. Feel free to skip this section if
it doesn&rsquo;t pertain to you.</p>
<h5 id="bootstrap-tokens">Bootstrap tokens</h5>
<p>A bootstrap token has the format of <code>[a-z0-9]{6}.[a-z0-9]{16}</code> where the first
part is a randomly generated token id and the second part after the <code>.</code> needs to
be a cryptographically secure random string. The token will look something like
this: <code>ke3uxh.vhxb3ttj1nquno5t</code>. That means you can generate a token with a
simple bash command like so:</p>
<pre><code class="language-console" data-lang="console">$ echo &quot;$(&lt; /dev/urandom tr -dc a-z0-9 | head -c${1:-6};echo;).$(&lt; /dev/urandom tr -dc a-z0-9 | head -c${1:-16};echo;)&quot;
</code></pre><h5 id="creating-the-secret">Creating the secret</h5>
<p>To actually &ldquo;create&rdquo; the bootstrap token, it needs to be placed in a <code>Secret</code> in
the <code>kube-system</code> namespace. The name of the secret should be
<code>bootstrap-token-&lt;token_id&gt;</code>. Specifically, the secret should look something
like this when you send it to the API:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Secret</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">bootstrap-token-&lt;token_id&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kube-system</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">bootstrap.kubernetes.io/token</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">stringData</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">auth-extra-groups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">system:bootstrappers:kubeadm:default-node-token</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">expiration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">2020-06-04T20:07:24Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">token-id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;token_id&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">token-secret</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;token_secret&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">usage-bootstrap-authentication</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;true&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">usage-bootstrap-signing</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;true&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>The main fields you need to set are <code>token-id</code>, <code>token-secret</code>, and
<code>expiration</code>.</p>
<h5 id="generating-the-kubeconfig">Generating the Kubeconfig</h5>
<p>Once you have a <code>Secret</code> created, you then have to generate the Kubeconfig. To
do so, you&rsquo;ll need several pieces of information:</p>
<ul>
<li>The CA cert for your Kubernetes API. This should be available from the
kubeconfig you are currently using</li>
<li>The server hostname or IP address</li>
<li>The generated bootstrap token</li>
</ul>
<p>You can either assemble a kubeconfig by hand or use similar steps to what is
found in the <a href="./assets/bootstrap.sh">bootstrap script</a></p>
<h5 id="an-example-bootstrap-config">An example bootstrap config</h5>
<p>This is an example of a bootstrap config file for reference if creating your own
workflow</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">clusters</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">certificate-authority-data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM1ekNDQWMrZ0F3SUJBZ0lCQVRBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwdGFXNXAKYTNWaVpVTkJNQjRYRFRFNE1EUXlOREF3TVRVME9Wb1hEVEk0TURReU1UQXdNVFUwT1Zvd0ZURVRNQkVHQTFVRQpBeE1LYldsdWFXdDFZbVZEUVRDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBS1lxCnhzMllBNzRETlFQTVZkbFJ3aXZFWnIwd0lTUHlQZjkzR3ZsUVNKMDQrbFgxSEF3Yi9GM3dqcDVEckVOSDAraTUKbjhZUy9QK3JlNUpqVU9tV1VmMXNtMmVLNHNRNHpNS01kMHc5by9ERlozTHc3K1h6RzMveTdvMkF4SWVlYjBPdgpzbzhwWUVOMklzRUcrRFhpa0l0MjhPZ1RtZGRhTVg1OWJQTXhGL0l6T1FPVmFEYmtnMk5ScWtjYW9CR0FTT2JkCkVId2hrVGdMYXZCNzVnVmRTVVlWUFU1M2dXc3hDQWVBYzNCaW9NekNLNmFFUXIrMDB4V3dEWkR4amxLYU02V3gKTWFQN0JmY0Y5K2U3OUt0Tkc3TXZMWG9xdFJ3cCtPdWREaTlKWHRLS1NNbVo3TFNubEY4UDdHUlhKL2IzNS9NVQpvQklkK1ZKNHpoak5zT2xKM3g4Q0F3RUFBYU5DTUVBd0RnWURWUjBQQVFIL0JBUURBZ0trTUIwR0ExVWRKUVFXCk1CUUdDQ3NHQVFVRkJ3TUNCZ2dyQmdFRkJRY0RBVEFQQmdOVkhSTUJBZjhFQlRBREFRSC9NQTBHQ1NxR1NJYjMKRFFFQkN3VUFBNElCQVFDWmM0SVpST3pnNS91eDdNa0Y3NmVja3dZekY4OUJiejRhRENVS3ByWUMxTDFvZVBVawpXdFc3VENWditDMDJRc2tGRnpTbGhlQUpYeXp5Q2xKMVE5VmUyUmR2bGtiZHVPTXpJeXZTS0xaZHVDT2pvVWNZCjkrMTN1UEFpaXJjNUpRZlBOTGdJcUdhbTB2ZXpqZEtROHNUK0o0WmRyNHdFOUZKQnhOeUhob0xQdjBLRENBbkcKWFlPZW5lTHdjcnJCcTVDTERRN2dIelZGbEFKVU1nSWF3ZzdtcG1HVi9KRlVlYnRpam1Cd1p1WDBNMTFpVHBqYQpNaUhDRkJOREd5a2locDBoSHdDV1ZId0ZXNHVLUWxUZjRBK2hieC9OTUkzbHhBYXozMFZKN3U1Mm1GR3pCQ0dvCmt3VjdKS2RJMEd1MGJQQmlUSDRMTmE4bWxqYmZkRnhsc2k4cAotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">server</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://192.168.64.19:8443</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minikube</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">contexts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">context</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minikube</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kube-system</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">user</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">tls-bootstrap-token-user</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">tls-bootstrap-token-user@kubernetes</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">current-context</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">tls-bootstrap-token-user@kubernetes</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Config</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">preferences</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{}<span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">users</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">tls-bootstrap-token-user</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">user</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">token</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ke3uxh.vhxb3ttj1nquno5t</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="running-krustlet">Running Krustlet</h3>
<p>Once you have the bootstrap config in place, you can run Krustlet:</p>
<pre><code class="language-console" data-lang="console">$ KUBECONFIG=~/.krustlet/config/kubeconfig krustlet-wasi --port 3000 --bootstrap-file /path/to/your/bootstrap.conf
</code></pre><p>Krustlet will begin the bootstrapping process, and then <strong>await manual
certificate approval</strong> (described below) before launching.</p>
<p>A couple important notes here. <code>KUBECONFIG</code> should almost always be set,
especially in developer/local machine situations. During the bootstrap process,
Krustlet will generate a kubeconfig with the credentials it obtains during the
bootstrapping process and write it out to the specified location in
<code>KUBECONFIG</code>. If a kubeconfig already exists there, it will be loaded and skip
the bootstrapping process. A similar process occurs during the bootstrapping of
the serving certificates, they will be written out to the paths specified by
<code>--cert-file</code> (default <code>$KRUSTLET_DATA_DIR/config/krustlet.crt</code>) and
<code>--private-key-file</code> (default <code>$KRUSTLET_DATA_DIR/config/krustlet.key</code>). If they
already exist, then they will be loaded and bootstrapping skipped.</p>
<h3 id="approving-the-serving-csr">Approving the serving CSR</h3>
<p>Once you have started Krustlet, there is one more manual step (though this could
be automated depending on your setup). The client certs Krustlet needs are
generally approved automatically by the API. However, the serving certs require
manual approval. To do this, you&rsquo;ll need the hostname you specified for the
<code>--hostname</code> flag or the output of <code>hostname</code> if you didn&rsquo;t specify anything.
Then run:</p>
<pre><code class="language-console" data-lang="console">$ kubectl certificate approve &lt;hostname&gt;-tls
</code></pre><p>Once you do this, Krustlet will automatically grab the new certs and start
running.</p>

	
		<style>
  .feedback--answer {
    display: inline-block;
  }
  .feedback--answer-no {
    margin-left: 1em;
  }
  .feedback--response {
    display: none;
    margin-top: 1em;
  }
  .feedback--response__visible {
    display: block;
  }
</style>
<h2 class="feedback--title">Feedback</h2>
<p class="feedback--question">Was this page helpful?</p>
<button class="feedback--answer feedback--answer-yes">Yes</button>
<button class="feedback--answer feedback--answer-no">No</button>
<p class="feedback--response feedback--response-yes">
  Glad to hear it! Please <a href="https://github.com/openservicemesh/osm/issues/new">tell us how we can improve</a>.
</p>
<p class="feedback--response feedback--response-no">
  Sorry to hear that. Please <a href="https://github.com/openservicemesh/osm/issues/new">tell us how we can improve</a>.
</p>
<script>
  const yesButton = document.querySelector('.feedback--answer-yes');
  const noButton = document.querySelector('.feedback--answer-no');
  const yesResponse = document.querySelector('.feedback--response-yes');
  const noResponse = document.querySelector('.feedback--response-no');
  const disableButtons = () => {
    yesButton.disabled = true;
    noButton.disabled = true;
  };
  const sendFeedback = (value) => {
    if (typeof ga !== 'function') return;
    const args = {
      command: 'send',
      hitType: 'event',
      category: 'Helpful',
      action: 'click',
      label: window.location.pathname,
      value: value
    };
    ga(args.command, args.hitType, args.category, args.action, args.label, args.value);
  };
  yesButton.addEventListener('click', () => {
    yesResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(1);
  });
  noButton.addEventListener('click', () => {
    noResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(0);
  });
</script>

		<br />
	
	
</div>


          </main>
        </div>
      </div>
      

<footer class="py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-6 text-xs-center order-sm-2">
        <p class="footer-cncf">Krustlet</p>
      </div>
      <div class="col-6 col-sm-6 text-right text-xs-center order-sm-3">
        <ul class="inline list-inline text-right">
          
          
          <li class="nav-item list-inline-item mr-4 mb-2 mb-lg-0">
            
            
            
            
            <a class="nav-link" href="https://krustlet.dev" target="_blank" ><span>Home</span></a>
          </li>
          
          <li class="nav-item list-inline-item mr-4 mb-2 mb-lg-0">
            
            
            
            
            <a class="nav-link" href="https://docs.krustlet.dev" target="_blank" ><span>Docs</span></a>
          </li>
          
          <li class="nav-item list-inline-item mr-4 mb-2 mb-lg-0">
            
            
            
            
            <a class="nav-link" href="https://github.com/deislabs/krustlet/" target="_blank" ><span>Github</span></a>
          </li>
          
          <li class="nav-item list-inline-item mr-4 mb-2 mb-lg-0">
            
            
            
            
            <a class="nav-link" href="https://kubernetes.slack.com/messages/krustlet" target="_blank" ><span>Slack</span></a>
          </li>
          
          <li class="nav-item list-inline-item mr-4 mb-2 mb-lg-0">
            
            
            
            
            <a class="nav-link" href="https://twitter.com/krustlet" target="_blank" ><span>Twitter</span></a>
          </li>
          
        </ul>
      </div>
    </div>
  </div>
</footer>



    </div>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>










<script src="/js/main.min.63db3e552bd0543be17ce4a79a18b744e9cb72256bec42b540e3ab0cd43722d0.js" integrity="sha256-Y9s&#43;VSvQVDvhfOSnmhi3ROnLciVr7EK1QOOrDNQ3ItA=" crossorigin="anonymous"></script>



<script src='/js/prism.js'></script>



  </body>
</html>
